<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>对话洞察仪表盘</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
:root {
    --bg-primary: #0f1117;
    --bg-card: #1a1d2e;
    --bg-card-hover: #222640;
    --text-primary: #e8eaed;
    --text-secondary: #9aa0a6;
    --text-muted: #5f6368;
    --accent-blue: #4e8cff;
    --accent-green: #34d399;
    --accent-purple: #a78bfa;
    --accent-orange: #fb923c;
    --accent-pink: #f472b6;
    --accent-cyan: #22d3ee;
    --border-color: #2a2d3e;
    --radius: 12px;
    --shadow: 0 4px 24px rgba(0,0,0,0.3);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
                 'Microsoft YaHei', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
}

.header {
    padding: 32px 40px 20px;
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(135deg, #0f1117 0%, #1a1d2e 100%);
}

.header h1 {
    font-size: 28px;
    font-weight: 700;
    letter-spacing: -0.5px;
}

.header .subtitle {
    color: var(--text-secondary);
    font-size: 14px;
    margin-top: 4px;
}

.container {
    max-width: 1440px;
    margin: 0 auto;
    padding: 24px 40px 60px;
}

/* Stat cards row */
.stat-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 16px;
    margin-bottom: 28px;
}

.stat-card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 20px 24px;
    border: 1px solid var(--border-color);
    transition: background 0.2s, transform 0.2s;
}

.stat-card:hover {
    background: var(--bg-card-hover);
    transform: translateY(-2px);
}

.stat-card .label {
    font-size: 12px;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.stat-card .value {
    font-size: 32px;
    font-weight: 700;
    font-variant-numeric: tabular-nums;
}

.stat-card:nth-child(1) .value { color: var(--accent-blue); }
.stat-card:nth-child(2) .value { color: var(--accent-green); }
.stat-card:nth-child(3) .value { color: var(--accent-purple); }
.stat-card:nth-child(4) .value { color: var(--accent-orange); }
.stat-card:nth-child(5) .value { color: var(--accent-pink); }
.stat-card:nth-child(6) .value { color: var(--accent-cyan); }

/* Chart grid */
.chart-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-bottom: 28px;
}

@media (max-width: 1024px) {
    .chart-grid { grid-template-columns: 1fr; }
    .container { padding: 16px 20px 40px; }
    .header { padding: 24px 20px 16px; }
}

.chart-card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 24px;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow);
    min-width: 0;
    overflow: hidden;
}

.chart-card h3 {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 16px;
    color: var(--text-primary);
}

.chart-wrapper {
    position: relative;
    width: 100%;
    height: 300px;
}

.chart-card.wide {
    grid-column: span 2;
}

@media (max-width: 1024px) {
    .chart-card.wide { grid-column: span 1; }
}

/* Reports table */
.reports-section {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 24px;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow);
}

.reports-section h3 {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 16px;
}

.reports-table {
    width: 100%;
    border-collapse: collapse;
}

.reports-table th {
    text-align: left;
    font-size: 11px;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 8px 12px;
    border-bottom: 1px solid var(--border-color);
}

.reports-table td {
    padding: 10px 12px;
    font-size: 13px;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-primary);
}

.reports-table tr:hover td {
    background: var(--bg-card-hover);
}

.report-summary {
    color: var(--text-secondary);
    font-size: 12px;
    line-height: 1.6;
}

.report-details {
    margin-top: 8px;
}

.report-details > summary {
    cursor: pointer;
    color: var(--accent-cyan);
    font-size: 12px;
    user-select: none;
}

.report-details ul {
    margin: 8px 0 0 18px;
    padding: 0;
}

.report-details li {
    margin: 4px 0;
    color: var(--text-secondary);
    font-size: 12px;
    line-height: 1.5;
}

.badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
}

.badge-l1 { background: rgba(78,140,255,0.2); color: var(--accent-blue); }
.badge-l2 { background: rgba(167,139,250,0.2); color: var(--accent-purple); }
.badge-l3 { background: rgba(52,211,153,0.2); color: var(--accent-green); }

.empty-state {
    text-align: center;
    padding: 40px;
    color: var(--text-muted);
    font-size: 14px;
}

/* L3 Prescriptive Section */
.l3-section {
    margin-top: 28px;
}

.l3-title {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--accent-green);
    display: inline-block;
}

.l3-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-bottom: 20px;
}

@media (max-width: 1024px) {
    .l3-grid { grid-template-columns: 1fr; }
}

.l3-card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 24px;
    border: 1px solid var(--border-color);
    border-left: 3px solid var(--accent-green);
    box-shadow: var(--shadow);
    min-width: 0;
    overflow: hidden;
    /* no height limit – show full content */
}

.l3-card h3 {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 16px;
    color: var(--accent-green);
}

.l3-card .block-h1 {
    font-size: 16px;
    font-weight: 700;
    margin: 16px 0 8px;
    color: var(--text-primary);
}

.l3-card .block-h2 {
    font-size: 14px;
    font-weight: 600;
    margin: 14px 0 6px;
    color: var(--accent-purple);
}

.l3-card .block-p {
    font-size: 13px;
    color: var(--text-secondary);
    margin: 4px 0;
    line-height: 1.6;
}

.l3-card .block-li {
    font-size: 13px;
    color: var(--text-secondary);
    margin: 3px 0;
    padding-left: 16px;
    position: relative;
    line-height: 1.6;
}

.l3-card .block-li::before {
    content: '';
    position: absolute;
    left: 4px;
    top: 8px;
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: var(--accent-green);
}

.l3-card .block-li.numbered {
    padding-left: 24px;
    counter-increment: li-counter;
}

.l3-card .block-li.numbered::before {
    content: counter(li-counter) '.';
    background: none;
    font-size: 12px;
    font-weight: 600;
    color: var(--accent-green);
    top: 0;
    left: 0;
    width: auto;
    height: auto;
    border-radius: 0;
}

.l3-card .block-callout {
    font-size: 12px;
    color: var(--text-muted);
    background: rgba(52, 211, 153, 0.08);
    padding: 8px 12px;
    border-radius: 6px;
    margin: 6px 0;
    border-left: 3px solid var(--accent-green);
}

.l3-card .block-divider {
    border: none;
    border-top: 1px solid var(--border-color);
    margin: 12px 0;
}

.l3-card .block-quote {
    font-size: 13px;
    color: var(--text-secondary);
    border-left: 3px solid var(--accent-purple);
    padding-left: 12px;
    margin: 8px 0;
    font-style: italic;
}

.footer {
    text-align: center;
    padding: 24px;
    color: var(--text-muted);
    font-size: 12px;
}
</style>
</head>
<body>

<div class="header">
    <h1>对话洞察仪表盘</h1>
    <div class="subtitle">
        数据来源：本地 JSON （离线模式） &nbsp;|&nbsp;
        生成时间：2026-02-10 11:42
    </div>
</div>

<div class="container">
    <!-- Stat Cards -->
    <div class="stat-cards">
        <div class="stat-card">
            <div class="label">对话总数</div>
            <div class="value" id="stat-conversations">-</div>
        </div>
        <div class="stat-card">
            <div class="label">总轮次</div>
            <div class="value" id="stat-turns">-</div>
        </div>
        <div class="stat-card">
            <div class="label">工具调用</div>
            <div class="value" id="stat-tools">-</div>
        </div>
        <div class="stat-card">
            <div class="label">平台数</div>
            <div class="value" id="stat-platforms">-</div>
        </div>
        <div class="stat-card">
            <div class="label">领域数</div>
            <div class="value" id="stat-domains">-</div>
        </div>
        <div class="stat-card">
            <div class="label">分析报告</div>
            <div class="value" id="stat-reports">-</div>
        </div>
    </div>

    <!-- Charts Grid -->
    <div class="chart-grid">
        <!-- 1. Platform Distribution (Pie) -->
        <div class="chart-card">
            <h3>平台分布</h3>
            <div class="chart-wrapper">
                <canvas id="chart-platform"></canvas>
            </div>
        </div>

        <!-- 2. Language Distribution (Doughnut) -->
        <div class="chart-card">
            <h3>语言分布</h3>
            <div class="chart-wrapper">
                <canvas id="chart-language"></canvas>
            </div>
        </div>

        <!-- 3. Timeline (Line) — wide -->
        <div class="chart-card wide">
            <h3>对话时间线（按月）</h3>
            <div class="chart-wrapper">
                <canvas id="chart-timeline"></canvas>
            </div>
        </div>

        <!-- 4. Tool Usage (Horizontal Bar) -->
        <div class="chart-card">
            <h3>工具使用排行</h3>
            <div class="chart-wrapper">
                <canvas id="chart-tools"></canvas>
            </div>
        </div>

        <!-- 5. Domain Map (Radar) -->
        <div class="chart-card">
            <h3>知识领域分布</h3>
            <div class="chart-wrapper">
                <canvas id="chart-domains"></canvas>
            </div>
        </div>

        <!-- 6. Depth Distribution (Bar) -->
        <div class="chart-card">
            <h3>对话深度分布</h3>
            <div class="chart-wrapper">
                <canvas id="chart-depth"></canvas>
            </div>
        </div>

        <!-- 7. Model Distribution (Bar) -->
        <div class="chart-card">
            <h3>模型使用分布</h3>
            <div class="chart-wrapper">
                <canvas id="chart-models"></canvas>
            </div>
        </div>

        <!-- 8. Task Type Distribution (Horizontal Bar) -->
        <div class="chart-card">
            <h3>任务类型分布</h3>
            <div class="chart-wrapper">
                <canvas id="chart-task-type"></canvas>
            </div>
        </div>

        <!-- 9. Difficulty Distribution (Bar) -->
        <div class="chart-card">
            <h3>对话难度分布</h3>
            <div class="chart-wrapper">
                <canvas id="chart-difficulty"></canvas>
            </div>
        </div>

        <!-- 10. Prompt Quality Distribution (Bar) -->
        <div class="chart-card">
            <h3>提示词质量评分分布</h3>
            <div class="chart-wrapper">
                <canvas id="chart-prompt-quality"></canvas>
            </div>
        </div>

        <!-- 11. Outcome Distribution (Pie) -->
        <div class="chart-card">
            <h3>对话结果分布</h3>
            <div class="chart-wrapper">
                <canvas id="chart-outcome"></canvas>
            </div>
        </div>

        <!-- 12. Cognitive Patterns (Horizontal Bar) — wide -->
        <div class="chart-card wide">
            <h3>认知模式分布</h3>
            <div class="chart-wrapper">
                <canvas id="chart-cognitive"></canvas>
            </div>
        </div>
    </div>

    <!-- 8. Recent Reports Table -->
    <div class="reports-section">
        <h3>分析报告</h3>
        <div id="reports-content"></div>
    </div>

    <!-- L3 Prescriptive Section -->
    <div class="l3-section">
        <h2 class="l3-title">L3 处方层 — 改进建议与行动方向</h2>

        <!-- Improvement Directions (from Agent Skill insights) -->
        <div class="l3-grid" id="l3-insights-grid"></div>

        <div class="l3-grid">
            <!-- User Profile -->
            <div class="l3-card">
                <h3>用户画像</h3>
                <div id="l3-profile"></div>
            </div>

            <!-- Coaching -->
            <div class="l3-card">
                <h3>辅导建议</h3>
                <div id="l3-coaching"></div>
            </div>
        </div>

        <!-- L3 sub-pages (Templates, Learning Plan, Automation) -->
        <div class="l3-grid" id="l3-pages-grid"></div>
    </div>
</div>

<div class="footer">
    Conversation Insights Dashboard &mdash; 自动生成
</div>

<script>
// Embedded data
const DATA = {"summary": {"total_conversations": 1390, "total_turns": 8723, "total_tool_uses": 1492, "platform_count": 4, "domain_count": 29, "report_count": 0}, "platform_distribution": {"codex": 791, "chatgpt": 554, "claude_code": 38, "claude_web": 7}, "timeline": [{"month": "2023-03", "count": 1}, {"month": "2023-04", "count": 2}, {"month": "2023-07", "count": 1}, {"month": "2023-10", "count": 2}, {"month": "2023-11", "count": 14}, {"month": "2023-12", "count": 10}, {"month": "2024-01", "count": 2}, {"month": "2024-02", "count": 1}, {"month": "2024-03", "count": 44}, {"month": "2024-04", "count": 6}, {"month": "2024-05", "count": 5}, {"month": "2024-06", "count": 3}, {"month": "2024-08", "count": 6}, {"month": "2024-09", "count": 14}, {"month": "2024-10", "count": 10}, {"month": "2024-11", "count": 25}, {"month": "2024-12", "count": 15}, {"month": "2025-01", "count": 12}, {"month": "2025-02", "count": 27}, {"month": "2025-03", "count": 29}, {"month": "2025-04", "count": 20}, {"month": "2025-05", "count": 38}, {"month": "2025-06", "count": 64}, {"month": "2025-07", "count": 38}, {"month": "2025-08", "count": 3}, {"month": "2025-09", "count": 14}, {"month": "2025-10", "count": 30}, {"month": "2025-11", "count": 26}, {"month": "2025-12", "count": 34}, {"month": "2026-01", "count": 91}, {"month": "2026-02", "count": 803}], "tool_stats": [{"name": "Bash", "usage": 418, "success_rate": 97.4}, {"name": "Read", "usage": 230, "success_rate": 99.6}, {"name": "Edit", "usage": 128, "success_rate": 98.4}, {"name": "Write", "usage": 99, "success_rate": 98.0}, {"name": "TodoWrite", "usage": 86, "success_rate": 100.0}, {"name": "gpt_action", "usage": 79, "success_rate": 0.0}, {"name": "file_search", "usage": 76, "success_rate": 0.0}, {"name": "canvas", "usage": 61, "success_rate": 0.0}, {"name": "memory", "usage": 45, "success_rate": 0.0}, {"name": "Grep", "usage": 40, "success_rate": 100.0}, {"name": "TaskOutput", "usage": 35, "success_rate": 100.0}, {"name": "WebSearch", "usage": 27, "success_rate": 100.0}, {"name": "file_browser", "usage": 19, "success_rate": 0.0}, {"name": "Glob", "usage": 17, "success_rate": 100.0}, {"name": "TaskUpdate", "usage": 16, "success_rate": 100.0}, {"name": "mcp__plugin_uniswap-integrations_chrome-devtools__take_screenshot", "usage": 14, "success_rate": 100.0}, {"name": "Task", "usage": 13, "success_rate": 100.0}, {"name": "web_search", "usage": 13, "success_rate": 0.0}, {"name": "dalle", "usage": 11, "success_rate": 0.0}, {"name": "plugin:plugin_promptperfect_xyz", "usage": 10, "success_rate": 0.0}, {"name": "WebFetch", "usage": 9, "success_rate": 44.4}, {"name": "AskUserQuestion", "usage": 6, "success_rate": 100.0}, {"name": "ExitPlanMode", "usage": 4, "success_rate": 50.0}, {"name": "mcp__plugin_uniswap-integrations_chrome-devtools__evaluate_script", "usage": 4, "success_rate": 100.0}, {"name": "plugin:gpt_promptperfect_xyz", "usage": 4, "success_rate": 0.0}, {"name": "api_tool", "usage": 3, "success_rate": 0.0}, {"name": "plugin:bibigpt_co", "usage": 3, "success_rate": 0.0}, {"name": "plugin:thegeneralmind_com", "usage": 3, "success_rate": 0.0}, {"name": "mcp__plugin_uniswap-integrations_chrome-devtools__navigate_page", "usage": 2, "success_rate": 100.0}, {"name": "TaskStop", "usage": 2, "success_rate": 100.0}, {"name": "TaskCreate", "usage": 2, "success_rate": 100.0}, {"name": "web_browser", "usage": 2, "success_rate": 0.0}, {"name": "deep_research", "usage": 2, "success_rate": 0.0}, {"name": "plugin:api_trendup_ai", "usage": 2, "success_rate": 0.0}, {"name": "plugin:video_ai_invideo_io", "usage": 2, "success_rate": 0.0}, {"name": "plugin:www_veed_io", "usage": 2, "success_rate": 0.0}, {"name": "mcp__plugin_uniswap-integrations_chrome-devtools__take_snapshot", "usage": 1, "success_rate": 100.0}, {"name": "mcp__plugin_uniswap-integrations_chrome-devtools__list_pages", "usage": 1, "success_rate": 100.0}, {"name": "computer_use", "usage": 1, "success_rate": 0.0}], "domain_map": [{"name": "ai-ml", "count": 850, "depth": 0.0, "trend": "stable"}, {"name": "database", "count": 817, "depth": 0.0, "trend": "stable"}, {"name": "frontend", "count": 797, "depth": 0.0, "trend": "stable"}, {"name": "documentation", "count": 796, "depth": 0.0, "trend": "stable"}, {"name": "other", "count": 212, "depth": 0.0, "trend": "stable"}, {"name": "creative", "count": 111, "depth": 0.0, "trend": "stable"}, {"name": "marketing", "count": 99, "depth": 0.0, "trend": "stable"}, {"name": "research", "count": 95, "depth": 0.0, "trend": "stable"}, {"name": "legal", "count": 91, "depth": 0.0, "trend": "stable"}, {"name": "business", "count": 87, "depth": 0.0, "trend": "stable"}, {"name": "writing", "count": 84, "depth": 0.0, "trend": "stable"}, {"name": "backend", "count": 83, "depth": 0.0, "trend": "stable"}, {"name": "data-science", "count": 79, "depth": 0.0, "trend": "stable"}, {"name": "design", "count": 72, "depth": 0.0, "trend": "stable"}, {"name": "education", "count": 50, "depth": 0.0, "trend": "stable"}, {"name": "automotive", "count": 49, "depth": 0.0, "trend": "stable"}, {"name": "productivity", "count": 46, "depth": 0.0, "trend": "stable"}, {"name": "immigration", "count": 38, "depth": 0.0, "trend": "stable"}, {"name": "real-estate", "count": 37, "depth": 0.0, "trend": "stable"}, {"name": "health", "count": 35, "depth": 0.0, "trend": "stable"}, {"name": "food", "count": 26, "depth": 0.0, "trend": "stable"}, {"name": "ecommerce", "count": 26, "depth": 0.0, "trend": "stable"}, {"name": "mobile", "count": 24, "depth": 0.0, "trend": "stable"}, {"name": "testing", "count": 23, "depth": 0.0, "trend": "stable"}, {"name": "finance", "count": 23, "depth": 0.0, "trend": "stable"}, {"name": "devops", "count": 19, "depth": 0.0, "trend": "stable"}, {"name": "security", "count": 18, "depth": 0.0, "trend": "stable"}, {"name": "crypto-web3", "count": 16, "depth": 0.0, "trend": "stable"}, {"name": "architecture", "count": 11, "depth": 0.0, "trend": "stable"}], "depth_distribution": {"1": 944, "2-5": 228, "6-10": 105, "10+": 113}, "language_distribution": {"mixed": 731, "zh": 569, "en": 90}, "model_distribution": {"gpt-5.3-codex": 783, "gpt-4o": 234, "gpt-5-2": 73, "gpt-5": 55, "unknown": 49, "gpt-4": 37, "gpt-4-gizmo": 33, "gpt-5-1": 23, "gpt-4-5": 19, "o3": 17, "research": 12, "o1": 9, "claude": 7, "text-davinci-002-render-sha": 7, "gpt-5-thinking": 5, "gpt-5.2-codex": 4, "gpt-5-2-thinking": 4, "gpt-4o-jawbone": 4, "o3-mini": 3, "gpt-4-plugins": 3, "gpt-5.2": 2, "gpt-5.1-codex-mini": 2, "gpt-4o-mini": 2, "gpt-5-2-instant": 1, "gpt-5-t-mini": 1, "gpt-4-1": 1}, "task_type_distribution": {"research": 143, "learning": 94, "new-feature": 83, "other": 65, "debugging": 56, "documentation": 45, "brainstorming": 33, "data-analysis": 33, "configuration": 25, "design": 21, "writing": 4, "deployment": 4, "code-review": 4}, "difficulty_distribution": {"1": 147, "2": 182, "3": 81, "4": 82, "5": 49, "6": 32, "7": 16, "8": 11, "9": 2, "10": 8}, "outcome_distribution": {"resolved": 301, "exploratory": 164, "partial": 145}, "prompt_quality_distribution": {"0-20": 1, "21-40": 516, "41-60": 56, "61-80": 34, "81-100": 3}, "cognitive_pattern_distribution": {"scope_creep": 64, "perfectionism": 17}, "recent_reports": [], "user_profile": [{"type": "heading_1", "text": "AI 协作画像"}, {"type": "heading_2", "text": "基本信息"}, {"type": "bulleted_list_item", "text": "**主要使用平台**：chatgpt (98.6%), claude_web (1.2%), claude_code (0.2%)"}, {"type": "bulleted_list_item", "text": "**偏好语言**：中文"}, {"type": "bulleted_list_item", "text": "**对话数量**：562 次"}, {"type": "heading_2", "text": "技术画像"}, {"type": "bulleted_list_item", "text": "**擅长领域**：ecommerce"}, {"type": "bulleted_list_item", "text": "**正在学习**：other, business, marketing, research, writing"}, {"type": "bulleted_list_item", "text": "**常用工具**：gpt_action, file_search, canvas, memory, Bash, Read, file_browser"}, {"type": "heading_2", "text": "协作风格"}, {"type": "bulleted_list_item", "text": "**提示词风格**：moderate"}, {"type": "bulleted_list_item", "text": "**平均提示词长度**：约 26 词"}, {"type": "bulleted_list_item", "text": "**常见纠正类型**：scope(102次), factual(21次), approach(15次)"}, {"type": "heading_2", "text": "痛点与机会"}, {"type": "bulleted_list_item", "text": "**检测到的认知模式**：direct-query, topic-jumping, progressive-deepening, role-setting, iterative-refinement"}, {"type": "bulleted_list_item", "text": "**未充分利用的工具**：plugin:thegeneralmind_com, plugin:www_veed_io, plugin:video_ai_invideo_io"}, {"type": "heading_2", "text": "个性化建议"}, {"type": "paragraph", "text": "当与此用户协作时："}, {"type": "paragraph", "text": "1. 使用 中文 进行交流"}, {"type": "paragraph", "text": "2. 提供详细解释"}, {"type": "paragraph", "text": "3. 主动使用常用工具"}, {"type": "paragraph", "text": "4. 关注上述痛点，提供针对性帮助"}, {"type": "divider", "text": ""}, {"type": "paragraph", "text": "生成时间：2026-02-06T11:04:39.787836+00:00"}], "coaching": [], "l3_pages": [], "local_insights": {}, "l3_outputs": {"user_profile_md": "# AI 协作画像\n\n## 基本信息\n- **主要使用平台**：chatgpt (98.6%), claude_web (1.2%), claude_code (0.2%)\n- **偏好语言**：中文\n- **对话数量**：562 次\n\n## 技术画像\n- **擅长领域**：ecommerce\n- **正在学习**：other, business, marketing, research, writing\n- **常用工具**：gpt_action, file_search, canvas, memory, Bash, Read, file_browser\n\n## 协作风格\n- **提示词风格**：moderate\n- **平均提示词长度**：约 26 词\n- **常见纠正类型**：scope(102次), factual(21次), approach(15次)\n\n## 痛点与机会\n- **检测到的认知模式**：direct-query, topic-jumping, progressive-deepening, role-setting, iterative-refinement\n- **未充分利用的工具**：plugin:thegeneralmind_com, plugin:www_veed_io, plugin:video_ai_invideo_io\n\n## 个性化建议\n当与此用户协作时：\n1. 使用 中文 进行交流\n2. 提供详细解释\n3. 主动使用常用工具\n4. 关注上述痛点，提供针对性帮助\n\n---\n*生成时间：2026-02-06T11:04:39.787836+00:00*\n", "user_profile_data": {"platform_usage": {"primary_platform": "chatgpt", "platform_breakdown": {"chatgpt": {"percentage": 98.6, "count": 554, "top_models": {"gpt-4o": 234, "gpt-5-2": 73, "gpt-5": 55}}, "claude_web": {"percentage": 1.2, "count": 7, "top_models": {"claude": 7}}, "claude_code": {"percentage": 0.2, "count": 1, "top_models": {"unknown": 1}}}}, "language_preferences": {"primary": "zh", "distribution": {"zh": 80.7, "en": 16.5, "mixed": 2.8}}, "active_hours": {"peak_hours": [6, 8, 9, 11, 12], "peak_days": ["Thu", "Wed", "Fri"], "weekday_vs_weekend": {"weekday": 432, "weekend": 130}}, "technical_profile": {"expertise_areas": {"strong": ["ecommerce"], "developing": ["other", "business", "marketing", "research", "writing", "creative", "education", "ai-ml", "productivity", "health", "automotive", "immigration", "real-estate", "finance", "legal", "database", "food", "backend", "design"], "exploring": []}, "top_domains": ["other", "business", "marketing", "research", "writing", "creative", "education", "ai-ml", "productivity", "health"], "common_task_types": {"research": 224, "other": 139, "writing": 86, "learning": 50, "brainstorming": 46}}, "tool_patterns": {"frequently_used": ["gpt_action", "file_search", "canvas", "memory", "Bash", "Read", "file_browser"], "underused": ["plugin:thegeneralmind_com", "plugin:www_veed_io", "plugin:video_ai_invideo_io", "deep_research", "plugin:gpt_promptperfect_xyz"], "total_tool_uses": 448, "tool_success_rates": {"Bash": 95.5, "Write": 80.0, "Edit": 100.0, "TodoWrite": 100.0, "Read": 100.0, "Grep": 100.0, "TaskOutput": 100.0}}, "collaboration_style": {"avg_prompt_length": 26.2, "avg_turns_per_conversation": 7.2, "style_indicators": ["moderate"], "correction_distribution": {"scope": 102, "factual": 21, "approach": 15, "style": 5}, "outcome_distribution": {"resolved": 513, "partial": 24, "exploratory": 17, "abandoned": 8}}, "pain_points": {"cognitive_patterns": {"direct-query": 113, "topic-jumping": 74, "progressive-deepening": 46, "role-setting": 36, "iterative-refinement": 31}, "correction_reasons": {"scope_change": 20, "style_preference": 10, "user_changed_mind": 3, "ai_error": 1}}, "conversation_count": 562, "generated_at": "2026-02-06T11:04:39.787836+00:00"}, "best_practices_md": "# AI 协作最佳实践\n\n> 基于 545 个高效对话提取，生成于 2026-02-06\n\n---\n\n## 高效对话模式\n\n以下特征在高效对话中出现频率较高：\n\n- **使用编号列表**：出现率 2.4%（13 次）\n- **结构化格式**：出现率 2.4%（13 次）\n- **使用项目符号**：出现率 2.0%（11 次）\n- **描述预期行为**：出现率 1.5%（8 次）\n- **包含文件路径引用**：出现率 0.9%（5 次）\n- **包含代码块**：出现率 0.2%（1 次）\n\n## 场景化提示词模板\n\n### 调试对话模板\n**场景**：代码报错需要 AI 帮助定位问题\n**样本数**：1 个高效对话\n\n**模板**：\n```\n错误信息：[完整错误堆栈]\n复现步骤：\n1. [步骤1]\n2. [步骤2]\n\n已尝试：\n- [已经试过的方案]\n\n预期行为：[应该发生什么]\n\n相关代码：\n```\n[相关代码片段]\n```\n```\n\n**技巧**：\n- 包含完整错误信息\n- 说明复现步骤\n- 列出已尝试的方案\n\n### 新功能开发模板\n**场景**：需要 AI 帮助实现新功能\n**样本数**：2 个高效对话\n\n**模板**：\n```\n功能需求：[简要描述功能目的]\n\n详细要求：\n1. [具体要求1]\n2. [具体要求2]\n\n约束条件：\n- [技术限制或规范]\n\n参考代码位置：[相关文件路径]\n```\n\n**技巧**：\n- 明确功能目的\n- 列出具体要求\n- 说明约束条件\n\n### 技术调研模板\n**场景**：需要 AI 帮助调研技术方案\n**样本数**：219 个高效对话\n\n**模板**：\n```\n调研主题：[主题]\n\n背景：[为什么需要调研]\n\n关注方面：\n1. [方面1]\n2. [方面2]\n\n约束条件：[如技术栈、性能要求等]\n\n期望产出：[文档/对比表/建议]\n```\n\n**技巧**：\n- 明确调研范围\n- 说明约束条件\n- 定义期望产出\n\n## 避坑指南\n\n### AP-001: 避免模糊代词开头\n**反例**：\"这个报错怎么解决\"\n**正例**：\"运行 pytest 时出现 ImportError，错误信息如下...\"\n\n### AP-002: 避免缺少上下文的改动请求\n**反例**：\"改一下这个函数\"\n**正例**：\"修改 src/utils.py 中的 calculate_total 函数，添加对负数的处理\"\n\n## 工具使用技巧\n\n### TT-001: 并行搜索\n**场景**：需要在多个位置查找信息\n**做法**：一次发送多个 Grep/Glob 请求，而不是逐个发送\n**效果**：减少等待时间\n\n### TT-002: 使用 Task 工具分解复杂任务\n**场景**：多步骤复杂任务\n**做法**：使用 Task 工具派发子任务给专门的 agent\n**效果**：保持上下文清晰，提高处理质量\n\n---\n*最后更新：2026-02-06*", "improvement_plan_md": "# 个人改进计划 - 2026-02-06\n\n> 基于 562 次对话分析生成\n\n---\n\n## 本周重点 (3 项)\n\n### 1. [高] 提升提示词清晰度\n- **问题**：56.8% 的提示词清晰度较低\n- **行动**：\n  - [ ] 使用调试/新功能模板\n  - [ ] 每次请求包含文件路径和代码上下文\n  - [ ] 明确说明预期行为\n- **验证**：下周提示词清晰度评分 > 60\n- **依赖**：无\n\n### 2. [中] 提升对话效率\n- **问题**：平均每次对话 7.2 轮\n- **行动**：\n  - [ ] 一次性提供完整需求，避免逐步补充\n  - [ ] 复杂任务先确认理解再执行\n  - [ ] 使用结构化格式（列表/步骤）\n- **验证**：平均对话轮次 < 5\n- **依赖**：#1 完成后\n\n### 3. [中] 增加工具使用多样性\n- **问题**：高价值工具未充分利用：Task, Grep, Glob\n- **行动**：\n  - [ ] 尝试使用 Task 工具\n  - [ ] 跨文件搜索时使用 Task + Explore agent\n  - [ ] 多个独立搜索并行执行\n- **验证**：Task 使用率 > 5%\n\n---\n\n## AI 复利路径\n\n```\n当前阶段\n    │\n    ├── 解锁 → 提示词清晰度\n    │\n    │         │\n    │         └── 解锁 → 对话效率提升\n    │\n    │         │\n    │         └── 解锁 → 处理更复杂任务\n    │\n    │         │\n    │         └── 解锁 → 自动化工作流\n    │\n    └── 里程碑：连续 5 次对话 < 5 轮\n```\n\n---\n\n## 进度追踪\n\n| 周 | 核心指标 | 目标 | 实际 | 状态 |\n|----|----------|------|------|------|\n| W1 | 提升提示词清晰度... | 下周提示词清晰度评分... | - | 进行中 |\n| W1 | 提升对话效率... | 平均对话轮次 < 5... | - | 进行中 |\n| W1 | 增加工具使用多样性... | Task 使用率 >... | - | 进行中 |\n\n---\n\n## 详细诊断\n\n### 提示词质量\n- 低清晰度比例：56.8%\n- 缺少上下文比例：2.3%\n\n### 对话效率\n- 平均对话轮次：7.2\n- 高轮次对话比例：20.3%\n- 放弃对话比例：1.4%\n\n### 工具使用\n- 工具使用总次数：448\n- 工具多样性：26 种\n- 未充分利用：Task, Grep, Glob\n\n### 认知模式\n- direct-query：113 次\n- topic-jumping：74 次\n- progressive-deepening：46 次\n- role-setting：36 次\n- iterative-refinement：31 次\n\n---\n\n## 改进储备（后续周）\n\n- [low] 注意认知模式：direct-query：检测到 113 次 direct-query 模式\n\n---\n*生成时间：2026-02-06*"}};

// ---- Helpers ----
function formatNumber(n) {
    if (n >= 10000) return (n / 1000).toFixed(1) + 'k';
    return n.toLocaleString('zh-CN');
}

const COLORS = {
    blue:   '#4e8cff',
    green:  '#34d399',
    purple: '#a78bfa',
    orange: '#fb923c',
    pink:   '#f472b6',
    cyan:   '#22d3ee',
    yellow: '#fbbf24',
    red:    '#f87171',
    indigo: '#818cf8',
    teal:   '#2dd4bf',
    lime:   '#a3e635',
    rose:   '#fb7185',
};

const PALETTE = Object.values(COLORS);
const PALETTE_ALPHA = PALETTE.map(c => c + '33');

const chartDefaults = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
        legend: {
            labels: { color: '#9aa0a6', font: { size: 12 } }
        }
    }
};

Chart.defaults.color = '#9aa0a6';
Chart.defaults.borderColor = '#2a2d3e';

// ---- Stat Cards ----
document.getElementById('stat-conversations').textContent = formatNumber(DATA.summary.total_conversations);
document.getElementById('stat-turns').textContent = formatNumber(DATA.summary.total_turns);
document.getElementById('stat-tools').textContent = formatNumber(DATA.summary.total_tool_uses);
document.getElementById('stat-platforms').textContent = DATA.summary.platform_count;
document.getElementById('stat-domains').textContent = DATA.summary.domain_count;
document.getElementById('stat-reports').textContent = DATA.summary.report_count;

// ---- 1. Platform Distribution (Pie) ----
(() => {
    const labels = Object.keys(DATA.platform_distribution);
    const values = Object.values(DATA.platform_distribution);
    new Chart(document.getElementById('chart-platform'), {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: PALETTE.slice(0, labels.length),
                borderWidth: 0,
            }]
        },
        options: {
            ...chartDefaults,
            plugins: {
                ...chartDefaults.plugins,
                legend: { position: 'right', labels: { color: '#9aa0a6', padding: 12, font: { size: 12 } } },
            }
        }
    });
})();

// ---- 2. Language Distribution (Doughnut) ----
(() => {
    const labels = Object.keys(DATA.language_distribution);
    const values = Object.values(DATA.language_distribution);
    new Chart(document.getElementById('chart-language'), {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: [COLORS.blue, COLORS.orange, COLORS.purple, ...PALETTE.slice(3)],
                borderWidth: 0,
                cutout: '55%',
            }]
        },
        options: {
            ...chartDefaults,
            plugins: {
                ...chartDefaults.plugins,
                legend: { position: 'right', labels: { color: '#9aa0a6', padding: 12, font: { size: 12 } } },
            }
        }
    });
})();

// ---- 3. Timeline (Line) ----
(() => {
    const labels = DATA.timeline.map(d => d.month);
    const values = DATA.timeline.map(d => d.count);
    new Chart(document.getElementById('chart-timeline'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: '对话数',
                data: values,
                borderColor: COLORS.blue,
                backgroundColor: COLORS.blue + '20',
                fill: true,
                tension: 0.3,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: COLORS.blue,
            }]
        },
        options: {
            ...chartDefaults,
            scales: {
                x: { grid: { color: '#1f2234' }, ticks: { color: '#9aa0a6', maxRotation: 45 } },
                y: { grid: { color: '#1f2234' }, ticks: { color: '#9aa0a6' }, beginAtZero: true }
            },
            plugins: {
                ...chartDefaults.plugins,
                legend: { display: false }
            }
        }
    });
})();

// ---- 4. Tool Usage (Horizontal Bar) ----
(() => {
    const top = DATA.tool_stats.slice(0, 15);
    const labels = top.map(d => d.name);
    const values = top.map(d => d.usage);
    new Chart(document.getElementById('chart-tools'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '调用次数',
                data: values,
                backgroundColor: COLORS.purple + 'aa',
                borderColor: COLORS.purple,
                borderWidth: 1,
                borderRadius: 4,
            }]
        },
        options: {
            ...chartDefaults,
            indexAxis: 'y',
            scales: {
                x: { grid: { color: '#1f2234' }, ticks: { color: '#9aa0a6' }, beginAtZero: true },
                y: { grid: { display: false }, ticks: { color: '#9aa0a6', font: { size: 11 } } }
            },
            plugins: {
                ...chartDefaults.plugins,
                legend: { display: false }
            }
        }
    });
})();

// ---- 5. Domain Map (Radar) ----
(() => {
    const top = DATA.domain_map.slice(0, 10);
    const labels = top.map(d => d.name);
    const values = top.map(d => d.count);
    new Chart(document.getElementById('chart-domains'), {
        type: 'radar',
        data: {
            labels: labels,
            datasets: [{
                label: '对话数',
                data: values,
                borderColor: COLORS.cyan,
                backgroundColor: COLORS.cyan + '30',
                pointBackgroundColor: COLORS.cyan,
                pointBorderColor: COLORS.cyan,
                pointRadius: 4,
            }]
        },
        options: {
            ...chartDefaults,
            scales: {
                r: {
                    grid: { color: '#2a2d3e' },
                    angleLines: { color: '#2a2d3e' },
                    pointLabels: { color: '#9aa0a6', font: { size: 11 } },
                    ticks: { display: false },
                    beginAtZero: true,
                }
            },
            plugins: {
                ...chartDefaults.plugins,
                legend: { display: false }
            }
        }
    });
})();

// ---- 6. Depth Distribution (Bar) ----
(() => {
    const labels = Object.keys(DATA.depth_distribution);
    const values = Object.values(DATA.depth_distribution);
    new Chart(document.getElementById('chart-depth'), {
        type: 'bar',
        data: {
            labels: labels.map(l => l + ' 轮'),
            datasets: [{
                label: '对话数',
                data: values,
                backgroundColor: [COLORS.green + 'cc', COLORS.blue + 'cc', COLORS.orange + 'cc', COLORS.pink + 'cc'],
                borderWidth: 0,
                borderRadius: 6,
            }]
        },
        options: {
            ...chartDefaults,
            scales: {
                x: { grid: { display: false }, ticks: { color: '#9aa0a6' } },
                y: { grid: { color: '#1f2234' }, ticks: { color: '#9aa0a6' }, beginAtZero: true }
            },
            plugins: {
                ...chartDefaults.plugins,
                legend: { display: false }
            }
        }
    });
})();

// ---- 7. Model Distribution (Bar) ----
(() => {
    // Sort by count, take top 12
    const entries = Object.entries(DATA.model_distribution)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 12);
    const labels = entries.map(e => e[0]);
    const values = entries.map(e => e[1]);
    new Chart(document.getElementById('chart-models'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '对话数',
                data: values,
                backgroundColor: PALETTE.slice(0, labels.length).map(c => c + 'cc'),
                borderWidth: 0,
                borderRadius: 4,
            }]
        },
        options: {
            ...chartDefaults,
            scales: {
                x: { grid: { display: false }, ticks: { color: '#9aa0a6', maxRotation: 45, font: { size: 10 } } },
                y: { grid: { color: '#1f2234' }, ticks: { color: '#9aa0a6' }, beginAtZero: true }
            },
            plugins: {
                ...chartDefaults.plugins,
                legend: { display: false }
            }
        }
    });
})();

// ---- 8. Task Type Distribution (Horizontal Bar) ----
(() => {
    const entries = Object.entries(DATA.task_type_distribution || {})
        .sort((a, b) => b[1] - a[1]);
    const labels = entries.map(e => e[0]);
    const values = entries.map(e => e[1]);
    new Chart(document.getElementById('chart-task-type'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '对话数',
                data: values,
                backgroundColor: COLORS.orange + 'aa',
                borderColor: COLORS.orange,
                borderWidth: 1,
                borderRadius: 4,
            }]
        },
        options: {
            ...chartDefaults,
            indexAxis: 'y',
            scales: {
                x: { grid: { color: '#1f2234' }, ticks: { color: '#9aa0a6' }, beginAtZero: true },
                y: { grid: { display: false }, ticks: { color: '#9aa0a6', font: { size: 11 } } }
            },
            plugins: { ...chartDefaults.plugins, legend: { display: false } }
        }
    });
})();

// ---- 9. Difficulty Distribution (Bar) ----
(() => {
    const labels = Object.keys(DATA.difficulty_distribution || {});
    const values = Object.values(DATA.difficulty_distribution || {});
    const bgColors = labels.map(l => {
        const v = parseInt(l);
        if (v <= 2) return COLORS.green + 'cc';
        if (v <= 4) return COLORS.blue + 'cc';
        if (v <= 6) return COLORS.orange + 'cc';
        if (v <= 8) return COLORS.pink + 'cc';
        return COLORS.red + 'cc';
    });
    new Chart(document.getElementById('chart-difficulty'), {
        type: 'bar',
        data: {
            labels: labels.map(l => '难度 ' + l),
            datasets: [{
                label: '对话数',
                data: values,
                backgroundColor: bgColors,
                borderWidth: 0,
                borderRadius: 4,
            }]
        },
        options: {
            ...chartDefaults,
            scales: {
                x: { grid: { display: false }, ticks: { color: '#9aa0a6' } },
                y: { grid: { color: '#1f2234' }, ticks: { color: '#9aa0a6' }, beginAtZero: true }
            },
            plugins: { ...chartDefaults.plugins, legend: { display: false } }
        }
    });
})();

// ---- 10. Prompt Quality Distribution (Bar) ----
(() => {
    const labels = Object.keys(DATA.prompt_quality_distribution || {});
    const values = Object.values(DATA.prompt_quality_distribution || {});
    const bgColors = [COLORS.red + 'cc', COLORS.orange + 'cc', COLORS.yellow + 'cc', COLORS.blue + 'cc', COLORS.green + 'cc'];
    new Chart(document.getElementById('chart-prompt-quality'), {
        type: 'bar',
        data: {
            labels: labels.map(l => l + ' 分'),
            datasets: [{
                label: '对话数',
                data: values,
                backgroundColor: bgColors,
                borderWidth: 0,
                borderRadius: 6,
            }]
        },
        options: {
            ...chartDefaults,
            scales: {
                x: { grid: { display: false }, ticks: { color: '#9aa0a6' } },
                y: { grid: { color: '#1f2234' }, ticks: { color: '#9aa0a6' }, beginAtZero: true }
            },
            plugins: { ...chartDefaults.plugins, legend: { display: false } }
        }
    });
})();

// ---- 11. Outcome Distribution (Pie) ----
(() => {
    const labels = Object.keys(DATA.outcome_distribution || {});
    const values = Object.values(DATA.outcome_distribution || {});
    const colorMap = { resolved: COLORS.green, partial: COLORS.orange, abandoned: COLORS.red, exploratory: COLORS.purple };
    const bgColors = labels.map(l => colorMap[l] || COLORS.blue);
    new Chart(document.getElementById('chart-outcome'), {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: bgColors,
                borderWidth: 0,
            }]
        },
        options: {
            ...chartDefaults,
            plugins: {
                ...chartDefaults.plugins,
                legend: { position: 'right', labels: { color: '#9aa0a6', padding: 12, font: { size: 12 } } },
            }
        }
    });
})();

// ---- 12. Cognitive Patterns (Horizontal Bar) ----
(() => {
    const entries = Object.entries(DATA.cognitive_pattern_distribution || {})
        .sort((a, b) => b[1] - a[1]);
    const labels = entries.map(e => e[0]);
    const values = entries.map(e => e[1]);
    new Chart(document.getElementById('chart-cognitive'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '出现次数',
                data: values,
                backgroundColor: COLORS.cyan + 'aa',
                borderColor: COLORS.cyan,
                borderWidth: 1,
                borderRadius: 4,
            }]
        },
        options: {
            ...chartDefaults,
            indexAxis: 'y',
            scales: {
                x: { grid: { color: '#1f2234' }, ticks: { color: '#9aa0a6' }, beginAtZero: true },
                y: { grid: { display: false }, ticks: { color: '#9aa0a6', font: { size: 11 } } }
            },
            plugins: { ...chartDefaults.plugins, legend: { display: false } }
        }
    });
})();

// ---- Reports Table ----
(() => {
    const container = document.getElementById('reports-content');
    const reports = DATA.recent_reports;

    if (!reports || reports.length === 0) {
        container.innerHTML = '<div class="empty-state">暂无分析报告数据（请先运行 pipeline）</div>';
        return;
    }

    let html = '<table class="reports-table"><thead><tr>';
    html += '<th>标题</th><th>日期</th><th>维度</th><th>关键洞察</th>';
    html += '</tr></thead><tbody>';

    reports.forEach(r => {
        const dim = r.dimension || '';
        const layer = (r.layer || '').toUpperCase();
        let badgeClass = 'badge-l1';
        if (layer === 'L2') badgeClass = 'badge-l2';
        else if (layer === 'L3') badgeClass = 'badge-l3';
        const badgeLabel = layer ? (layer + ' / ' + dim) : dim;

        const insights = r.insights || '';
        const details = Array.isArray(r.details) ? r.details : [];
        const detailsHtml = details.length > 0
            ? `<details class="report-details"><summary>查看详细洞察（${details.length} 条）</summary><ul>${details.map(d => `<li>${escapeHtml(d)}</li>`).join('')}</ul></details>`
            : '';

        html += '<tr>';
        html += `<td>${escapeHtml(r.title)}</td>`;
        html += `<td style="white-space:nowrap">${escapeHtml(r.date)}</td>`;
        html += `<td><span class="badge ${badgeClass}">${escapeHtml(badgeLabel)}</span></td>`;
        html += `<td><div class="report-summary">${escapeHtml(insights)}</div>${detailsHtml}</td>`;
        html += '</tr>';
    });

    html += '</tbody></table>';
    container.innerHTML = html;
})();

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// ---- L3 Block Renderer ----
function renderBlocks(blocks, containerId) {
    const container = document.getElementById(containerId);
    if (!blocks || blocks.length === 0) {
        container.innerHTML = '<div class="empty-state">暂无数据（需连接 Notion 并运行 L3 生成器）</div>';
        return;
    }

    let html = '';
    let numberedCounter = 0;
    blocks.forEach(b => {
        const text = escapeHtml(b.text || '');
        switch (b.type) {
            case 'heading_1':
                html += `<div class="block-h1">${text}</div>`;
                numberedCounter = 0;
                break;
            case 'heading_2':
            case 'heading_3':
                html += `<div class="block-h2">${text}</div>`;
                numberedCounter = 0;
                break;
            case 'paragraph':
                html += `<div class="block-p">${text}</div>`;
                break;
            case 'bulleted_list_item':
                html += `<div class="block-li">${text}</div>`;
                break;
            case 'numbered_list_item':
                numberedCounter++;
                html += `<div class="block-li numbered" style="counter-reset:li-counter ${numberedCounter - 1}">${text}</div>`;
                break;
            case 'callout':
                html += `<div class="block-callout">${text}</div>`;
                break;
            case 'quote':
                html += `<div class="block-quote">${text}</div>`;
                break;
            case 'divider':
                html += '<hr class="block-divider">';
                numberedCounter = 0;
                break;
            default:
                if (text) html += `<div class="block-p">${text}</div>`;
        }
    });
    container.innerHTML = html;
}

// ---- Render L3 Panels ----
renderBlocks(DATA.user_profile, 'l3-profile');
renderBlocks(DATA.coaching, 'l3-coaching');

// Render L3 sub-pages (Templates, Learning Plan, Automation)
(() => {
    const grid = document.getElementById('l3-pages-grid');
    const pages = DATA.l3_pages || [];

    if (pages.length === 0) return;

    const titleMap = {
        'Prompt Templates': '提示词反模式诊断',
        '提示词模板': '提示词反模式诊断',
        'Learning Plan': '学习计划',
        '学习计划': '学习计划',
        'Automation Suggestions': '自动化建议',
        '自动化建议': '自动化建议',
    };

    pages.forEach((p, i) => {
        const card = document.createElement('div');
        card.className = 'l3-card';
        const zhTitle = titleMap[p.base_title] || p.title;
        card.innerHTML = `<h3>${escapeHtml(zhTitle)}</h3><div id="l3-page-${i}"></div>`;
        grid.appendChild(card);
        // Render after appending to DOM
        renderBlocks(p.content, `l3-page-${i}`);
    });
})();

// ---- Render Local Insights (from Agent Skill Mode G) ----
(() => {
    const grid = document.getElementById('l3-insights-grid');
    const insights = DATA.local_insights || {};
    if (!insights.prompt_antipatterns && !insights.unresolved_concepts && !insights.improvement_directions) return;

    // Improvement Directions card
    const directions = insights.improvement_directions || [];
    if (directions.length > 0) {
        const card = document.createElement('div');
        card.className = 'l3-card';
        let html = '<h3>改进方向</h3>';
        directions.forEach(d => {
            const area = escapeHtml(d.area || '');
            const current = escapeHtml(d.current_pattern || '');
            const target = escapeHtml(d.target_pattern || '');
            const impact = escapeHtml(d.impact || '');
            html += `<div class="block-h2">${area}</div>`;
            if (current) html += `<div class="block-p">当前模式：${current}</div>`;
            if (target) html += `<div class="block-p">目标模式：${target}</div>`;
            if (impact) html += `<div class="block-callout">预期效果：${impact}</div>`;
        });
        card.innerHTML = html;
        grid.appendChild(card);
    }

    // Unresolved Concepts card
    const concepts = insights.unresolved_concepts || [];
    if (concepts.length > 0) {
        const card = document.createElement('div');
        card.className = 'l3-card';
        let html = '<h3>未掌握概念</h3>';
        concepts.forEach(c => {
            const name = escapeHtml(c.concept || '');
            const analysis = escapeHtml(c.analysis || '');
            const recommendation = escapeHtml(c.recommendation || '');
            html += `<div class="block-li">「${name}」`;
            if (analysis) html += ` — ${analysis}`;
            html += '</div>';
            if (recommendation) html += `<div class="block-callout">建议：${recommendation}</div>`;
        });
        card.innerHTML = html;
        grid.appendChild(card);
    }

    // Prompt Anti-patterns card
    const antipatterns = insights.prompt_antipatterns || [];
    if (antipatterns.length > 0) {
        const card = document.createElement('div');
        card.className = 'l3-card';
        card.style.gridColumn = 'span 2';
        let html = '<h3>提示词反模式分析</h3>';
        const total = antipatterns.reduce((s, a) => s + (a.frequency || 0), 0);
        html += `<div class="block-p">共检测到 ${antipatterns.length} 种反模式（${total} 个实例）</div>`;
        antipatterns.forEach(ap => {
            const name = escapeHtml(ap.pattern_name || '');
            const freq = ap.frequency || 0;
            const desc = escapeHtml(ap.description || '');
            html += `<div class="block-h2">${name}（${freq} 次）</div>`;
            if (desc) html += `<div class="block-p">${desc}</div>`;
        });
        card.innerHTML = html;
        grid.appendChild(card);
    }
})();
</script>
</body>
</html>